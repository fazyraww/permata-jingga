{% extends 'base.html' %}

{% block content %}
<style>
    /* Sembunyikan Sidebar dan Top Nav khusus di halaman login */
    .sidebar, .top-nav { display: none !important; }
    .main-wrapper { margin-left: 0 !important; padding: 0 !important; }
    
    .login-container {
        min-height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>

<div class="login-container">
    <div class="col-md-4 px-4">
        <div class="card p-5 border-0 shadow-lg rounded-4 text-center">
            <div class="mb-4">
                <div class="bg-warning d-inline-block p-3 rounded-circle mb-3 shadow">
                    <i class="fas fa-bus-alt text-white fs-2"></i>
                </div>
                <h3 class="fw-bold text-dark">Fahmi Travel</h3>
                <p class="text-muted small">Silakan masuk untuk mengelola reservasi</p>
            </div>

            <form id="loginForm">
                <div class="mb-3 text-start">
                    <label class="form-label small fw-bold text-muted">USERNAME</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light border-0"><i class="fas fa-user text-muted"></i></span>
                        <input type="text" id="username" class="form-control bg-light border-0 py-2" placeholder="Masukkan username" required>
                    </div>
                </div>
                <div class="mb-4 text-start">
                    <label class="form-label small fw-bold text-muted">PASSWORD</label>
                    <div class="input-group">
                        <span class="input-group-text bg-light border-0"><i class="fas fa-lock text-muted"></i></span>
                        <input type="password" id="password" class="form-control bg-light border-0 py-2" placeholder="Masukkan password" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100 fw-bold py-3 shadow rounded-3">
                    MASUK KE SISTEM <i class="fas fa-arrow-right ms-2"></i>
                </button>
            </form>
            
            <div class="mt-4">
                <p class="small text-muted">Belum punya akun? <a href="#" class="text-warning fw-bold text-decoration-none">Hubungi Admin</a></p>
            </div>
        </div>
    </div>
</div>



<script>
    document.getElementById('loginForm').onsubmit = async (e) => {
        e.preventDefault();
        
        const usernameInput = document.getElementById('username').value;
        const passwordInput = document.getElementById('password').value;
        
        // Animasi loading pada tombol
        const btn = e.target.querySelector('button');
        const originalText = btn.innerHTML;
        btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span> Memproses...';
        btn.disabled = true;

        const formData = new FormData();
        formData.append('username', usernameInput);
        formData.append('password', passwordInput);
        formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');

        try {
            const res = await fetch('{% url "home" %}', { 
                method: 'POST',
                body: formData,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            });

            if (res.ok) {
                // Simpan data login
                localStorage.setItem('username', usernameInput);
                // Jika backend kamu mengirimkan token (JWT), simpan juga di sini:
                // localStorage.setItem('access_token', data.token); 
                
                window.location.href = '/dashboard/'; 
            } else {
                alert('Username atau Password salah! Coba cek kembali.');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        } catch (err) {
            console.error(err);
            alert('Terjadi kesalahan koneksi ke server.');
            btn.innerHTML = originalText;
            btn.disabled = false;
        }
    };
</script>
{% endblock %}